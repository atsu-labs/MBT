# MBT - äº‹æ¡ˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

Cloudflare Pages + D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ + Remixï¼ˆReact Router v7ï¼‰ã‚’ä½¿ç”¨ã—ãŸã€ä½ç½®æƒ…å ±ãƒ™ãƒ¼ã‚¹ã®äº‹æ¡ˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

- ğŸ“ Leafletã‚’ä½¿ç”¨ã—ãŸåœ°å›³ä¸Šã§ã®äº‹æ¡ˆè¡¨ç¤º
- ğŸ’¼ PCå‘ã‘ç®¡ç†ç”»é¢ï¼ˆCRUDæ“ä½œå¯¾å¿œï¼‰
- ğŸ“± ãƒ¢ãƒã‚¤ãƒ«å‘ã‘é–²è¦§ç”»é¢
- ğŸ—„ï¸ Cloudflare D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
- ğŸš€ Cloudflare Pagesã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾å¿œ

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: React Router v7 (æ—§ Remix)
- **UI**: React 19
- **åœ°å›³**: Leaflet + React-Leaflet
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Cloudflare D1 (SQLite)
- **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: Cloudflare Pages
- **é–‹ç™ºè¨€èª**: TypeScript

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Node.js 20ä»¥ä¸Š
- npm ã¾ãŸã¯ yarn
- Cloudflareã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
```bash
git clone <repository-url>
cd MBT
```

2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install
```

### Cloudflare D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­å®š

1. Wranglerã«ãƒ­ã‚°ã‚¤ãƒ³
```bash
npx wrangler login
```

2. D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ
```bash
npx wrangler d1 create mbt-db
```

3. å‡ºåŠ›ã•ã‚ŒãŸdatabase_idã‚’ã‚³ãƒ”ãƒ¼ã—ã€`wrangler.toml`ã®`database_id`ã‚’æ›´æ–°

4. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ
```bash
npx wrangler d1 execute mbt-db --file=./migrations/0001_initial_schema.sql
```

### é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:5173 ã‚’é–‹ãã¾ã™ã€‚

## ä½¿ç”¨æ–¹æ³•

### ç®¡ç†ç”»é¢ï¼ˆPCï¼‰

1. ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‹ã‚‰ã€Œç®¡ç†ç”»é¢ã¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§çµ±è¨ˆæƒ…å ±ã¨åœ°å›³ã‚’ç¢ºèª
3. ã€Œäº‹æ¡ˆç®¡ç†ã€ã‹ã‚‰äº‹æ¡ˆã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ãŒå¯èƒ½
4. åœ°å›³ä¸Šã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä½ç½®ã‚’è¨­å®š

### é–²è¦§ç”»é¢ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰

1. ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‹ã‚‰ã€Œé–²è¦§ç”»é¢ã¸ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. åœ°å›³ä¸Šã§å…¨ã¦ã®äº‹æ¡ˆã‚’ç¢ºèª
3. ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«çµã‚Šè¾¼ã¿
4. ãƒªã‚¹ãƒˆã‹ã‚‰äº‹æ¡ˆã‚’é¸æŠã—ã¦è©³ç´°ã‚’ç¢ºèª

## ãƒ‡ãƒ—ãƒ­ã‚¤

### Cloudflare Pagesã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

1. ãƒ“ãƒ«ãƒ‰
```bash
npm run build
```

2. æœ¬ç•ªç’°å¢ƒç”¨D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```bash
npx wrangler d1 create mbt-db-production
npx wrangler d1 execute mbt-db-production --file=./migrations/0001_initial_schema.sql
```

3. ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
npm run deploy
```

ã¾ãŸã¯ã€GitHubé€£æºã‚’ä½¿ç”¨ã—ã¦è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã‚‚å¯èƒ½ã§ã™ã€‚

### Cloudflare Pagesã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š

1. Cloudflare Dashboardã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
2. ãƒ“ãƒ«ãƒ‰è¨­å®š:
   - ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰: `npm run build`
   - ãƒ“ãƒ«ãƒ‰å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: `build/client`
   - ãƒãƒ¼ãƒ‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 20
3. ç’°å¢ƒå¤‰æ•°ã¨D1ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¨­å®š

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
MBT/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ components/       # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ Map.tsx      # Leafletåœ°å›³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ lib/             # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ types.ts     # TypeScriptå‹å®šç¾©
â”‚   â”‚   â””â”€â”€ db.server.ts # D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
â”‚   â”œâ”€â”€ routes/          # ãƒ«ãƒ¼ãƒˆå®šç¾©
â”‚   â”‚   â”œâ”€â”€ _index.tsx   # ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”œâ”€â”€ admin.tsx    # ç®¡ç†ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â”œâ”€â”€ admin._index.tsx           # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ admin.cases._index.tsx     # äº‹æ¡ˆä¸€è¦§
â”‚   â”‚   â”œâ”€â”€ admin.cases.new.tsx        # äº‹æ¡ˆä½œæˆ
â”‚   â”‚   â”œâ”€â”€ admin.cases.$id.tsx        # äº‹æ¡ˆè©³ç´°
â”‚   â”‚   â”œâ”€â”€ admin.cases.$id.edit.tsx   # äº‹æ¡ˆç·¨é›†
â”‚   â”‚   â””â”€â”€ mobile.tsx                 # ãƒ¢ãƒã‚¤ãƒ«é–²è¦§ç”»é¢
â”‚   â”œâ”€â”€ styles/          # ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ root.tsx         # ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ entry.client.tsx # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â””â”€â”€ entry.server.tsx # ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ migrations/          # D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ public/             # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ wrangler.toml       # Cloudflareè¨­å®š
â”œâ”€â”€ vite.config.ts      # Viteè¨­å®š
â”œâ”€â”€ tsconfig.json       # TypeScriptè¨­å®š
â””â”€â”€ react-router.config.ts # React Routerè¨­å®š
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

### cases ãƒ†ãƒ¼ãƒ–ãƒ«

| ã‚«ãƒ©ãƒ å | å‹ | èª¬æ˜ |
|---------|-----|------|
| id | INTEGER | ä¸»ã‚­ãƒ¼ |
| title | TEXT | äº‹æ¡ˆã‚¿ã‚¤ãƒˆãƒ« |
| description | TEXT | äº‹æ¡ˆã®èª¬æ˜ |
| latitude | REAL | ç·¯åº¦ |
| longitude | REAL | çµŒåº¦ |
| status | TEXT | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (open/closed) |
| priority | TEXT | å„ªå…ˆåº¦ (high/medium/low) |
| created_at | DATETIME | ä½œæˆæ—¥æ™‚ |
| updated_at | DATETIME | æ›´æ–°æ—¥æ™‚ |

## é–‹ç™º

### å‹ãƒã‚§ãƒƒã‚¯

```bash
npm run typecheck
```

### ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ

```bash
npx wrangler d1 execute mbt-db --local --command="SELECT * FROM cases"
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ISC

## è²¢çŒ®

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­“è¿ã—ã¾ã™ã€‚å¤§ããªå¤‰æ›´ã®å ´åˆã¯ã€ã¾ãšissueã‚’é–‹ã„ã¦å¤‰æ›´å†…å®¹ã‚’è­°è«–ã—ã¦ãã ã•ã„ã€‚