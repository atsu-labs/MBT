# コントリビューションガイド

MBTプロジェクトへの貢献に興味をお持ちいただき、ありがとうございます！
このドキュメントでは、プロジェクトへの貢献方法について説明します。

## 行動規範

このプロジェクトでは、オープンで友好的な環境を維持することを目指しています。
すべての貢献者は敬意を持って接し、建設的なフィードバックを心がけてください。

## 貢献の種類

以下のような形で貢献できます：

- 🐛 バグ報告
- ✨ 新機能の提案
- 📝 ドキュメントの改善
- 🔧 コードの改善
- 🧪 テストの追加
- 🌐 翻訳

## 開発環境のセットアップ

### 必要な環境

- Node.js 20以上
- npm または yarn
- Git

### セットアップ手順

1. リポジトリをフォーク
2. ローカルにクローン
   ```bash
   git clone https://github.com/YOUR-USERNAME/MBT.git
   cd MBT
   ```
3. 依存関係をインストール
   ```bash
   npm install
   ```
4. 開発サーバーを起動
   ```bash
   npm run dev
   ```

詳細は [SETUP.md](SETUP.md) を参照してください。

## ブランチ戦略

- `main`: 安定版（本番環境）
- `develop`: 開発版（次期リリース準備）
- `feature/*`: 新機能開発
- `fix/*`: バグ修正
- `docs/*`: ドキュメント更新

### ブランチの作成

```bash
# 新機能の場合
git checkout -b feature/add-notification-system

# バグ修正の場合
git checkout -b fix/map-loading-issue

# ドキュメント更新の場合
git checkout -b docs/update-api-documentation
```

## コミットメッセージ

[Conventional Commits](https://www.conventionalcommits.org/) 形式を使用してください。

### フォーマット

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type（必須）

- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの動作に影響しない変更（空白、フォーマットなど）
- `refactor`: バグ修正でも機能追加でもないコード変更
- `test`: テストの追加・修正
- `chore`: ビルドプロセスやツールの変更

### 例

```bash
# 新機能
git commit -m "feat(map): マーカークラスタリング機能を追加"

# バグ修正
git commit -m "fix(database): D1接続エラーのハンドリングを改善"

# ドキュメント
git commit -m "docs: API.mdにエラーハンドリングの例を追加"
```

## コーディング規約

### TypeScript

- TypeScriptを使用し、`any`型の使用は最小限に
- すべてのpublic APIに型定義を追加
- JSDocコメントで関数の目的と使用例を記述

### React

- 関数コンポーネントとHooksを使用
- コンポーネント名はPascalCase
- Propsインターフェースを定義

### スタイル

- インデント: スペース2つ
- セミコロン: 使用する
- クォート: ダブルクォート（`"`）を優先
- 末尾カンマ: 使用する

### 例

```typescript
/**
 * 事案を取得して表示するコンポーネント
 * 
 * @example
 * ```tsx
 * <CaseList filters={{ status: "open" }} />
 * ```
 */
export function CaseList({ filters }: CaseListProps) {
  const [cases, setCases] = useState<Case[]>([]);

  useEffect(() => {
    // データ取得処理
  }, [filters]);

  return (
    <div className="case-list">
      {cases.map((caseItem) => (
        <CaseCard key={caseItem.id} case={caseItem} />
      ))}
    </div>
  );
}
```

## テスト

現在、テスト環境は整備中です。将来的には以下を計画しています：

- Unit tests（単体テスト）
- Integration tests（統合テスト）
- E2E tests（エンドツーエンドテスト）

## プルリクエストの作成

### 事前チェック

1. コードが正しくビルドできることを確認
   ```bash
   npm run build
   ```

2. 型チェックが通ることを確認
   ```bash
   npm run typecheck
   ```

3. コードがフォーマットされていることを確認

### プルリクエストの手順

1. 変更をコミット
   ```bash
   git add .
   git commit -m "feat: 新機能の説明"
   ```

2. リモートにプッシュ
   ```bash
   git push origin feature/your-feature-name
   ```

3. GitHubでプルリクエストを作成
   - 明確なタイトルをつける
   - 変更内容を詳しく説明
   - 関連するIssueがあればリンク
   - スクリーンショットを追加（UIの変更の場合）

### プルリクエストのテンプレート

```markdown
## 変更内容

この変更の概要を記述してください。

## 変更の理由

なぜこの変更が必要なのかを説明してください。

## 変更の種類

- [ ] バグ修正
- [ ] 新機能
- [ ] ドキュメント更新
- [ ] リファクタリング
- [ ] その他（説明：）

## チェックリスト

- [ ] ビルドが成功することを確認した
- [ ] 型チェックが通ることを確認した
- [ ] 関連するドキュメントを更新した
- [ ] 必要に応じてスクリーンショットを追加した

## スクリーンショット（UIの変更の場合）

変更前後のスクリーンショットを追加してください。

## 関連Issue

Closes #（Issue番号）
```

## レビュープロセス

1. プルリクエストが作成されると、メンテナーがレビューします
2. フィードバックがあれば、修正を行います
3. 承認されたら、メンテナーがマージします

### レビューでチェックされる項目

- コードの品質と可読性
- パフォーマンスへの影響
- セキュリティの考慮
- ドキュメントの整合性
- 既存機能への影響

## バグ報告

バグを見つけた場合は、以下の情報を含めてIssueを作成してください：

### テンプレート

```markdown
## バグの説明

バグの内容を明確に説明してください。

## 再現手順

1. '...'に移動
2. '...'をクリック
3. '...'までスクロール
4. エラーが表示される

## 期待される動作

本来どのように動作すべきかを説明してください。

## スクリーンショット

可能であれば、スクリーンショットを追加してください。

## 環境

- OS: [例: macOS 14.0]
- ブラウザ: [例: Chrome 120]
- Node.js: [例: 20.10.0]

## 追加情報

その他、問題の解決に役立つ情報があれば記載してください。
```

## 機能提案

新機能の提案は歓迎します！以下の情報を含めてIssueを作成してください：

### テンプレート

```markdown
## 機能の説明

提案する機能について説明してください。

## 動機・背景

なぜこの機能が必要なのかを説明してください。

## 提案する解決策

どのように実装するかのアイデアがあれば記載してください。

## 代替案

検討した代替案があれば記載してください。

## 追加情報

その他、参考になる情報があれば記載してください。
```

## ドキュメントの改善

ドキュメントの改善も重要な貢献です：

- 誤字脱字の修正
- 説明の明確化
- サンプルコードの追加
- 新機能のドキュメント化

ドキュメントは `docs/` ディレクトリとREADME.mdにあります。

## マーカーデータの編集

救護所、関門、エイド、AED、コースなどのマーカーデータを編集する場合：

1. `app/lib/markers/` 内のファイルを編集
2. GeoJSON形式を保持
3. [MARKERS.md](MARKERS.md) を参照して正しい形式で記述
4. 座標の順序に注意（[経度, 緯度]）

## リリースプロセス

（メンテナー向け）

1. バージョン番号を更新（`package.json`）
2. CHANGELOGを更新
3. タグを作成
   ```bash
   git tag -a v1.0.0 -m "Release v1.0.0"
   git push origin v1.0.0
   ```
4. GitHubでリリースを作成
5. Cloudflare Pagesにデプロイ

## 質問・サポート

質問がある場合は：

1. まず[ドキュメント](docs/)を確認
2. 既存のIssueを検索
3. 見つからない場合は新しいIssueを作成

## ライセンス

このプロジェクトに貢献することで、あなたの貢献がISCライセンスの下でライセンスされることに同意したものとみなされます。

## 感謝

プロジェクトへの貢献に感謝します！🎉
